# Google ID token verification
[![crates.io](https://img.shields.io/crates/v/google-jwt-signin.svg)](https://crates.io/crates/google-jwt-signin)
[![documentation](https://docs.rs/google-jwt-signin/badge.svg)](https://docs.rs/google-jwt-signin)

A simple way to authenticate users. A fork of https://crates.io/crates/google-jwt-verify focused on minimal code size.

Given a [client ID](https://developers.google.com/identity/protocols/oauth2#1.-obtain-oauth-2.0-credentials-from-the-dynamic_data.setvar.console_name-.)
and a [JSON web token](https://jwt.io/introduction/)
generated by the [signin process](https://developers.google.com/identity/gsi/web/guides/display-button),
verifies the token using steps described here:
https://developers.google.com/identity/gsi/web/reference/html-reference#server-side

Google's JSON web keys are automatically fetched and cached according to the returned Cache-Control headers.
Most requests to verify a token through this library will not wait for an HTTP request.

## Features
- `blocking` (default) Uses [ureq](https://github.com/algesten/ureq)
- `async` Uses [tokio](https://tokio.rs/)

For the sake of build simplicity, this crate chooses not to support native TLS.
[ring](https://github.com/briansmith/ring) is used for SSL encryption when fetching signing keys and also for signature verification.
Read about the ring security audit [here](https://jbp.io/2020/06/14/rustls-audit.html).

## Quick Start
```rust
//If you don't have a client id, get one from here: https://console.developers.google.com/
let client_id = "37772117408-qjqo9hca513pdcunumt7gk08ii6te8is.apps.googleusercontent.com";
let token = "...";// Obtain a signed token from Google
let client = Client::new(&client_id);
let id_token = client.verify_id_token(&token)?;
let greeting = authorize_token(&id_token);

// use authenticated token to authorize
fn authorize_token(token: &Token<IdPayload>) -> Option<String> {
    match token {
        Token {
            payload: payload @ IdPayload {
                email: Some(email), ..
            },
            ..
        } if TEST_USERS.contains(&email.as_str()) => {
            Some(format!("hello {}", payload.name.as_ref().unwrap_or(email)))
        }
        _ => None,
    }
}
```

## Issues
Be aware that Google's Oauth implementation is not well documented. The list of test users in the
[Oauth consent screen](https://developers.google.com/workspace/guides/configure-oauth-consent#configure_oauth_consent)
does not constitute an authorization whitelist (other users will also be granted access).
See this [issuetracker](https://issuetracker.google.com/issues/211370835?pli=1) for further details.

## Development
New issues are welcome for discussion. If it's a feature request, best to agree on whether it belongs here
before starting to work on a PR.

When running the tests, be sure to include the async feature: `cargo test --features=async`.
